---
title: Nodes API
description: Node management endpoints for StellarStack (Admin)
---

# Nodes API

Manage compute nodes in StellarStack. Most endpoints require admin privileges.

## List Nodes

Get all registered nodes.

```http
GET /api/v1/nodes
```

**Required Role:** Admin

### Query Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `page` | number | Page number (default: 1) |
| `limit` | number | Items per page (default: 20) |
| `status` | string | Filter by status |

### Response

```json
{
  "data": [
    {
      "id": "node_xxxxx",
      "name": "US West 1",
      "hostname": "node-us-west.example.com",
      "port": 5000,
      "status": "online",
      "region": "us-west",
      "specs": {
        "cpu": 8,
        "memory": 32768,
        "disk": 500000
      },
      "usage": {
        "cpu": 45.2,
        "memory": 68.5,
        "disk": 32.1,
        "servers": 12
      },
      "createdAt": "2024-01-01T00:00:00Z"
    }
  ],
  "meta": {
    "total": 3,
    "page": 1,
    "limit": 20
  }
}
```

## Get Node

Get details for a specific node.

```http
GET /api/v1/nodes/:id
```

**Required Role:** Admin

### Response

```json
{
  "data": {
    "id": "node_xxxxx",
    "name": "US West 1",
    "hostname": "node-us-west.example.com",
    "port": 5000,
    "status": "online",
    "region": "us-west",
    "specs": {
      "cpu": 8,
      "memory": 32768,
      "disk": 500000
    },
    "usage": {
      "cpu": 45.2,
      "memory": 68.5,
      "disk": 32.1,
      "servers": 12
    },
    "servers": [
      {
        "id": "server_xxxxx",
        "name": "Minecraft SMP",
        "status": "running"
      }
    ],
    "lastHeartbeat": "2024-01-01T12:00:00Z",
    "createdAt": "2024-01-01T00:00:00Z"
  }
}
```

## Get Node Stats

Get detailed statistics for a node.

```http
GET /api/v1/nodes/:id/stats
```

**Required Role:** Admin

### Response

```json
{
  "data": {
    "cpu": {
      "usage": 45.2,
      "cores": [42, 48, 51, 39, 45, 47, 50, 40]
    },
    "memory": {
      "used": 22478,
      "total": 32768,
      "percentage": 68.5
    },
    "disk": {
      "used": 160500,
      "total": 500000,
      "percentage": 32.1
    },
    "network": {
      "rxBytes": 1024000000,
      "txBytes": 512000000,
      "rxRate": 1024000,
      "txRate": 512000
    },
    "servers": {
      "total": 12,
      "running": 10,
      "stopped": 2
    },
    "uptime": 8640000
  }
}
```

## Generate Registration Token

Generate a token for registering a new node.

```http
POST /api/v1/admin/nodes/token
```

**Required Role:** Admin

### Request

```json
{
  "name": "EU West 1",
  "region": "eu-west",
  "maxServers": 50
}
```

### Response

```json
{
  "data": {
    "registrationToken": "strk_reg_xxxxx",
    "expiresAt": "2024-01-02T00:00:00Z"
  }
}
```

## Register Node

Register a new node (called by daemon).

```http
POST /api/v1/nodes/register
```

### Headers

```
X-Registration-Token: strk_reg_xxxxx
```

### Request

```json
{
  "publicKey": "-----BEGIN PUBLIC KEY-----...",
  "hostname": "node-eu-west.example.com",
  "port": 5000,
  "specs": {
    "cpu": 8,
    "memory": 32768,
    "disk": 500000
  }
}
```

### Response

```json
{
  "data": {
    "nodeId": "node_xxxxx",
    "apiToken": "strk_node_xxxxx",
    "certificate": "-----BEGIN CERTIFICATE-----...",
    "redisUrl": "redis://redis.example.com:6379"
  }
}
```

## Update Node

Update node configuration.

```http
PATCH /api/v1/nodes/:id
```

**Required Role:** Admin

### Request

```json
{
  "name": "Updated Name",
  "maxServers": 100
}
```

### Response

```json
{
  "data": {
    "id": "node_xxxxx",
    "name": "Updated Name",
    "updatedAt": "2024-01-01T12:00:00Z"
  }
}
```

## Delete Node

Remove a node from the platform.

```http
DELETE /api/v1/nodes/:id
```

**Required Role:** Admin

<Card>
  <CardHeader>
    <CardTitle>Warning</CardTitle>
  </CardHeader>
  <CardContent>
    You must migrate or delete all servers on the node before removing it.
  </CardContent>
</Card>

### Response

```json
{
  "success": true
}
```

## Drain Node

Prepare node for maintenance by migrating servers.

```http
POST /api/v1/nodes/:id/drain
```

**Required Role:** Admin

### Request

```json
{
  "targetNodeId": "node_yyyyy"
}
```

### Response

```json
{
  "data": {
    "status": "draining",
    "servers": {
      "total": 12,
      "migrated": 0,
      "remaining": 12
    }
  }
}
```

## Node Statuses

| Status | Description |
|--------|-------------|
| `online` | Node is healthy and accepting servers |
| `offline` | Node is not responding |
| `unhealthy` | Node has missed heartbeats |
| `draining` | Node is being evacuated |
| `maintenance` | Node is in maintenance mode |

## WebSocket Events

Nodes publish events to Redis for real-time updates:

```
stellar:nodes:{nodeId}:events
```

### Event Types

```typescript
type NodeEvent =
  | { type: 'status', status: 'online' | 'offline' | 'unhealthy' }
  | { type: 'metrics', data: NodeMetrics }
  | { type: 'server.status', serverId: string, status: string }
  | { type: 'heartbeat', timestamp: number };
```
